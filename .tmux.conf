# マウス操作を有効化（ホイールでcopy-modeに入りやすくなる）
set -g mouse on

# スクロールバック行数（好みで増やす）
set -g history-limit 100000

# ホイールで「tmuxの出力スクロールバック」を確実に見る
#    - WheelUp: copy-mode に入ってスクロール
#    - WheelDown: copy-mode中だけスクロール（通常時はアプリに渡さない）
bind-key -n WheelUpPane if-shell -F "#{pane_in_mode}" \
  "send-keys -M" \
  "copy-mode -e \; send-keys -M"

bind-key -n WheelDownPane if-shell -F "#{pane_in_mode}" \
  "send-keys -M"

# copy-mode をvi操作に & macOSクリップボード(pbcopy)へコピー
setw -g mode-keys vi

# vで選択開始、y/Enterでpbcopyして終了
bind-key -T copy-mode-vi v     send-keys -X begin-selection
bind-key -T copy-mode-vi y     send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi Escape send-keys -X cancel

# マウス選択の「離した瞬間に最下部へ戻る」問題の対策（コピーはするがcopy-modeは維持）
# ※デフォルトは MouseDragEnd1Pane が copy-pipe-and-cancel になっていて、解除で最下部へ戻りがち
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe "pbcopy"

# prefix を C-a に変更（Claude Code の C-b と競合回避）
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# TrueColor/RGB を tmux に明示（Ghostty + tmux 3.2+）
set -g default-terminal "tmux-256color"
set -as terminal-features ",xterm-ghostty:RGB"

# ESCの待ち時間を短くする
set -sg escape-time 10

# tcmux: ウィンドウ選択に coding agent ステータスを表示
bind-key w run-shell "tcmux lsw -A --color=always | fzf --ansi --layout reverse --tmux 80%,50% | cut -d: -f1 | xargs tmux select-window -t"
